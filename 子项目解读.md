# 第五层聚类分析｜厨刀市场细分（特征构建 + 聚类 + 商业画像）子项目解读

> 说明：本文中出现的相对路径，默认以项目根目录 `E:\PycharmProjects\三创赛` 为基准。

## 1. 子项目定位（在全链路中的作用）

本层将“产品属性 + 文本洞察（情感/方面）+ 标题解析（材质/刀型/套装）”融合成统一特征矩阵，对厨刀市场做**无监督细分（market segmentation）**，输出：

- 细分市场数量选择依据（K 选择图、PCA 方差等）
- 聚类结果可视化（PCA 分布、轮廓系数等）
- 每个簇的画像（均值表、Z-Score 雷达图、自动命名）
- 面向比赛的“商业洞察报告”（策略建议可直接写进项目书）

---

## 2. 本层使用的数据（输入文件）

工作目录：`第五层聚类分析/`

- `products_clean.csv`：产品维表（价格、BSR、折扣、Listing 质量、销量代理等）
- `reviews_cleaned.csv`：评论清洗表（用于 verified/有用票等聚合）
- `absa_detailed.csv`：方面情感明细（用于构建各方面情感特征）
- `bert_sentiment_results.csv`：情感结果（用于正负面比例等特征）

---

## 3. 核心脚本与做了什么

### 3.1 `prepare_clustering_data.py`（特征工程：把“可聚类”数据准备好）

**关键技术点**：

1. **字段映射适配**：把 `products_clean.csv` 的字段映射为标准字段（便于通用特征构建）
2. **标题解析（弱监督结构化）**：`KnifeTitleParser`
   - 材质识别：damascus / high_carbon / stainless / german_steel / japanese_steel / ceramic
   - 刀型识别：chef / santoku / cleaver / paring / steak / …
   - 套装识别：是否套装、件数 `set_pieces`、是否带刀座/刀套/礼盒等
   - 尺寸抽取：`blade_size_inch`
   - 品牌分层：premium/mid/budget（用于品牌层级编码）
3. **数值特征的稳健变换**：
   - `log_price / log_sales / log_reviews / log_bsr / log_days_on_market`
   - 组合指标：`weighted_rating`（评分×评论量思想）、`log_price_per_piece`
4. **NLP/口碑特征融合**：
   - 情感：`positive_ratio`、`bert_sentiment_mean`（后续聚类会去冗余）
   - ABSA：`aspect_*_sentiment` + `aspect_sentiment_mean`
5. **输出数据质量报告与分布图**

**输出（本目录根下）**：

- `clustering_features.csv`：全量特征（含业务字段与解析字段）
- `clustering_features_only.csv`：仅保留“聚类用特征列”的版本
- `feature_columns.txt`：特征列清单（便于项目书列举）
- `data_quality_report.txt`：缺失/异常值检查报告
- `feature_distributions.png`：核心特征分布（用于说明特征合理性）

### 3.2 `clustering_analysis.py`（聚类主流程：选择 K、训练、可视化、画像、报告）

核心流程（脚本输出也对应这些图）：

1. 特征预处理：缺失填充、标准化（Standard/Robust）
2. 相关性分析：`correlation_matrix.png`（识别冗余/共线）
3. 降维分析：PCA（解释方差）+ t-SNE（辅助可视化）
4. K 选择：肘部法（inertia）+ 轮廓系数（silhouette）+ CH/DB 指数
5. 聚类训练：K-Means++（并对比层次聚类、GMM 等算法）
6. 簇画像：均值表 `cluster_profiles.csv` + Z-Score 表 `cluster_profiles_zscore.csv`
7. 簇命名与建议：`cluster_names.csv` + `business_insights_report.txt`

**输出目录**：`clustering_results/`

### 3.3 `clustering_analysis_rerun.py`（复跑对比：不覆盖旧结果）

用途：对 `clustering_features_only.csv` 进行更严格/更合理的过滤后复跑，并将结果写入：

- `clustering_results_rerun/<时间戳>/`

并输出对比看板 `comparison_dashboard.png` 与对比指标表。

---

## 4. 输出图像/数据怎么解读（项目书写法：逐图给话术）

### 4.1 特征准备阶段

- `feature_distributions.png`
  - 含义：展示价格、评分、销量代理、评论量等关键特征的分布是否合理（通常长尾）
  - 写法：*“图X 表明电商特征呈明显长尾（销量/评论/排名），因此后续采用 log 变换与标准化以提升聚类稳定性。”*

- `data_quality_report.txt`
  - 含义：缺失值、异常值、字段覆盖率检查
  - 写法：用于“数据质量控制”一节，说明已做缺失处理与异常修正

### 4.2 聚类阶段（`clustering_results/`）

- `correlation_matrix.png`
  - 含义：特征相关性热力（识别冗余特征）
  - 写法：*“图X 用于检测共线性，避免冗余特征主导聚类距离计算。”*

- `pca_variance.png`
  - 含义：PCA 主成分解释方差（评估降维信息保留）
  - 写法：*“图X 显示前 N 个主成分已覆盖主要方差，可用于二维可视化与噪声压缩。”*

- `optimal_k_analysis.png`
  - 含义：不同 k 下 inertia、silhouette、CH、DB 等综合评价
  - 写法：*“图X 综合多指标选择最合适的细分市场数量（本次为 k=5），避免过分细碎或过度粗糙。”*

- `dendrogram.png`
  - 含义：层次聚类树状图（验证市场结构是否存在层级）
  - 写法：作为“方法对比”补充图，体现你们不是只跑 KMeans

- `clustering_results.png`
  - 含义：PCA 二维散点 + 簇颜色（簇分布与可分性直观呈现）
  - 写法：*“图X 展示样本在 PCA 空间的分布与聚类结果，不同颜色代表不同细分市场。”*

- `cluster_radar_chart.png`
  - 含义：各簇在关键特征的 Z-Score 雷达图（画像最直观）
  - 写法：*“图X 用标准分数展示簇画像：高单价/套装/日系口碑等特征差异一目了然。”*

- `cluster_analysis_dashboard.png`
  - 含义：聚类效果综合看板（PCA 分布 + 轮廓系数分布 + 簇规模等）
  - 写法：用于“聚类有效性”与“可解释性”两节

### 4.3 结果表（项目书“细分市场画像表”素材）

推荐在项目书直接引用：

- `cluster_names.csv`：簇名、规模、占比
- `cluster_profiles.csv`：簇均值画像（可转成项目书表格）
- `cluster_profiles_zscore.csv`：簇标准化画像（用于解释“高于/低于整体均值”）
- `business_insights_report.txt`：自动生成的细分市场洞察与建议（可直接改写为策略）

示例（来自现有 `business_insights_report.txt`）：

- Cluster 0：主流-高单价-单品（单品、单价/单件价更高）
- Cluster 1：主流-低单价-套装（套装件数多、带刀座）
- Cluster 3：细分-口碑佳（日系/方面情感显著高）
- Cluster 4：细分-低单价-套装但口碑较差（销量/评论高但情感低，需改善质量体验）

> 项目书写法：以“市场份额 + 差异化特征 + 策略建议”三段写每个簇。

---

## 5. 复现运行方式（建议按两步跑）

在 `第五层聚类分析/` 下：

```bash
# 1) 生成聚类特征
python prepare_clustering_data.py

# 2) 跑聚类主流程（输出到 clustering_results/）
python clustering_analysis.py

# 3) （可选）复跑对比（输出到 clustering_results_rerun/<时间戳>/）
python clustering_analysis_rerun.py
```

---

## 6. 注意事项（项目书可写“局限性/改进”）

- 轮廓系数在高维、簇结构复杂时可能偏低（脚本已输出 silhouette/CH/DB 多指标，不建议只盯 silhouette）。
- 市场细分结果依赖特征工程口径（特别是标题解析与品牌分层规则），项目书中建议补一段“规则可迭代更新”。
